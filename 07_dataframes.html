
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DataFrames and Series &#8212; Elements of Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '07_dataframes';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Distributions" href="08_distributions.html" />
    <link rel="prev" title="Plotting" href="06_plotting.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Elements of Data Science</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Elements of Data Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_variables.html">Variables and Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_times.html">Times and Places</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_arrays.html">Lists and Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_loops.html">Loops and Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_dictionaries.html">Dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_plotting.html">Plotting</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">DataFrames and Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_distributions.html">Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_relationships.html">Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_regression.html">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_resampling.html">Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_bootstrap.html">Bootstrap Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_hypothesis.html">Hypothesis Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_outro.html">Further Reading</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="resample_logit.html">Resampling and Logistic Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="anderson.html">Never Test for Normality</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ElementsOfDataScience" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/07_dataframes.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>DataFrames and Series</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data">Reading the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series">Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">Validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-statistics">Summary Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series-arithmetic">Series Arithmetic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#histograms">Histograms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#boolean-series">Boolean Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-data">Filtering Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#weighted-means">Weighted Means</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-an-extract">Making an Extract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>Printed copies of <em>Elements of Data Science</em> are available now, with a <strong>full color interior</strong>, from <a class="reference external" href="https://www.lulu.com/shop/allen-downey/elements-of-data-science/paperback/product-9dyrwn.html">Lulu.com</a>.</p>
<section class="tex2jax_ignore mathjax_ignore" id="dataframes-and-series">
<h1>DataFrames and Series<a class="headerlink" href="#dataframes-and-series" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ElementsOfDataScience/blob/v1/07_dataframes.ipynb">Click here to run this notebook on Colab</a>.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>

<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>

        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">local</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">filename</span>

<span class="n">download</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/AllenDowney/ElementsOfDataScience/v1/utils.py&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">utils</span>
</pre></div>
</div>
</div>
</div>
<p>This chapter introduces Pandas, a Python library that provides functions for reading and writing data files, exploring and analyzing data, and generating visualizations.
And it provides two new types for working with data, <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<p>We will use these tools to answer a data question – what is the average birth weight of babies in the United States?
This example will demonstrate important steps in almost any data science project:</p>
<ol class="arabic simple">
<li><p>Identifying data that can answer a question.</p></li>
<li><p>Obtaining the data and loading it in Python.</p></li>
<li><p>Checking the data and dealing with errors.</p></li>
<li><p>Selecting relevant subsets from the data.</p></li>
<li><p>Using histograms to visualize a distribution of values.</p></li>
<li><p>Using summary statistics to describe the data in a way that best answers the question.</p></li>
<li><p>Considering possible sources of error and limitations in our conclusions.</p></li>
</ol>
<p>Let’s start by getting the data.</p>
<section id="reading-the-data">
<h2>Reading the Data<a class="headerlink" href="#reading-the-data" title="Link to this heading">#</a></h2>
<p>To estimate average birth weight, we’ll use data from the National Survey of Family Growth (NSFG), which is available from the National Center for Health Statistics.
To download the data, you have to agree to the Data User’s Agreement.
URLs for the data and the agreement are in the notebook for this chapter.</p>
<p>The NSFG data is available from <a class="reference external" href="https://www.cdc.gov/nchs/nsfg">https://www.cdc.gov/nchs/nsfg</a>.</p>
<p>The Data User’s Agreement is at <a class="reference external" href="https://www.cdc.gov/nchs/data_access/ftp_dua.htm">https://www.cdc.gov/nchs/data_access/ftp_dua.htm</a>.</p>
<p>You should read the terms carefully, but let me draw your attention to what I think is the most important one:</p>
<blockquote>
<div><p>Make no attempt to learn the identity of any person or establishment included in these data.</p>
</div></blockquote>
<p>NSFG respondents answer questions of the most personal nature with the expectation that their identities will not be revealed.
As ethical data scientists, we should respect their privacy and adhere to the terms of use.</p>
<p>Respondents to the NSFG provide general information about themselves, which is stored in the respondent file, and information about each time they have been pregnant, which is stored in the pregnancy file.</p>
<p>We will work with the pregnancy file, which contains one row for each pregnancy and one column for each question on the NSFG questionnaire.</p>
<p>The data is stored in a fixed-width format, which means that every row is the same length and each column spans a fixed range of characters.
For example, the first six characters in each row represent a a unique identifier for each respondent; the next two characters indicate whether a pregnancy is the respondent’s first, second, etc.</p>
<p>To read this data, we need a <strong>data dictionary</strong>, which specifies the names of the columns and the index where each one begins and ends.
The data and the data dictionary are available in separate files.
Instructions for downloading them are in the notebook for this chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dict_file</span> <span class="o">=</span> <span class="s1">&#39;2015_2017_FemPregSetup.dct&#39;</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="s1">&#39;2015_2017_FemPregData.dat&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Pandas can read data in most common formats, including CSV, Excel, and fixed-width format, but it cannot read the data dictionary, which is in Stata format.
For that, we’ll use a Python library called <code class="docutils literal notranslate"><span class="pre">statadict</span></code>.</p>
<p>From <code class="docutils literal notranslate"><span class="pre">statadict</span></code>, we’ll import <code class="docutils literal notranslate"><span class="pre">parse_stata_dict</span></code>, which reads the data dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statadict</span> <span class="kn">import</span> <span class="n">parse_stata_dict</span>

<span class="n">stata_dict</span> <span class="o">=</span> <span class="n">parse_stata_dict</span><span class="p">(</span><span class="n">dict_file</span><span class="p">)</span>
<span class="n">stata_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;statadict.base.StataDict at 0x7fe63035c7f0&gt;
</pre></div>
</div>
</div>
</div>
<p>The result is an object that contains</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">names</span></code>, which is a list of column names, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">colspecs</span></code>, which is a list of tuples, where each tuple contains the first and last index of a column.</p></li>
</ul>
<p>These values are exactly the arguments we need to use <code class="docutils literal notranslate"><span class="pre">read_fwf</span></code>, which is the Pandas function that reads a file in fixed-width format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">nsfg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> 
                   <span class="n">names</span><span class="o">=</span><span class="n">stata_dict</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> 
                   <span class="n">colspecs</span><span class="o">=</span><span class="n">stata_dict</span><span class="o">.</span><span class="n">colspecs</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">nsfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.frame.DataFrame
</pre></div>
</div>
</div>
</div>
<p>The result is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, which is the primary type Pandas uses to store data.
<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> has a method called <code class="docutils literal notranslate"><span class="pre">head</span></code> that shows the first 5 rows:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_solution tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CASEID</th>
      <th>PREGORDR</th>
      <th>HOWPREG_N</th>
      <th>HOWPREG_P</th>
      <th>MOSCURRP</th>
      <th>NOWPRGDK</th>
      <th>PREGEND1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>70627</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>70627</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>70627</td>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>70628</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>70628</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The first two columns are <code class="docutils literal notranslate"><span class="pre">CASEID</span></code> and <code class="docutils literal notranslate"><span class="pre">PREGORDR</span></code>, which I mentioned earlier.
The first three rows have the same <code class="docutils literal notranslate"><span class="pre">CASEID</span></code>, which means this respondent reported three pregnancies.
The values of <code class="docutils literal notranslate"><span class="pre">PREGORDR</span></code> indicate that they are the first, second, and third pregnancies, in that order.
We will learn more about the other columns as we go along.</p>
<p>In addition to methods like <code class="docutils literal notranslate"><span class="pre">head</span></code>, a <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> object has several <strong>attributes</strong>, which are variables associated with the object.
For example, <code class="docutils literal notranslate"><span class="pre">nsfg</span></code> has an attribute called <code class="docutils literal notranslate"><span class="pre">shape</span></code>, which is a tuple containing the number of rows and columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9553, 248)
</pre></div>
</div>
</div>
</div>
<p>There are 9553 rows in this dataset, one for each pregnancy, and 248 columns, one for each question.
<code class="docutils literal notranslate"><span class="pre">nsfg</span></code> also has an attribute called <code class="docutils literal notranslate"><span class="pre">columns</span></code>, which contains the column names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;CASEID&#39;, &#39;PREGORDR&#39;, &#39;HOWPREG_N&#39;, &#39;HOWPREG_P&#39;, &#39;MOSCURRP&#39;, &#39;NOWPRGDK&#39;,
       &#39;PREGEND1&#39;, &#39;PREGEND2&#39;, &#39;HOWENDDK&#39;, &#39;NBRNALIV&#39;,
       ...
       &#39;SECU&#39;, &#39;SEST&#39;, &#39;CMINTVW&#39;, &#39;CMLSTYR&#39;, &#39;CMJAN3YR&#39;, &#39;CMJAN4YR&#39;,
       &#39;CMJAN5YR&#39;, &#39;QUARTER&#39;, &#39;PHASE&#39;, &#39;INTVWYEAR&#39;],
      dtype=&#39;object&#39;, length=248)
</pre></div>
</div>
</div>
</div>
<p>The column names are stored in an <code class="docutils literal notranslate"><span class="pre">Index</span></code>, which is another Pandas type, similar to a list.</p>
<p>Based on the names, you might be able to guess what some of the columns are, but in general you have to read the documentation.
When you work with datasets like the NSFG, it is important to read the documentation carefully.
If you interpret a column incorrectly, you can generate nonsense results and never realize it.</p>
<p>So, before we start looking at data, let’s get familiar with the NSFG codebook, which describes every column.
Instructions for downloading it are in the notebook for this chapter.</p>
<p>You can download the codebook for this dataset from <a class="github reference external" href="https://github.com/AllenDowney/ElementsOfDataScience/raw/v1/data/2015-2017_NSFG_FemPregFile_Codebook-508.pdf">AllenDowney/ElementsOfDataScience</a>.</p>
<p>If you search that document for “weigh at birth” you should find these columns related to birth weight.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BIRTHWGT_LB1</span></code>: Birthweight in Pounds - 1st baby from this pregnancy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BIRTHWGT_OZ1</span></code>: Birthweight in Ounces - 1st baby from this pregnancy</p></li>
</ul>
<p>There are similar columns for a 2nd or 3rd baby, in the case of twins or triplets.
For now we will focus on the first baby from each pregnancy, and we will come back to the issue of multiple births.</p>
</section>
<section id="series">
<h2>Series<a class="headerlink" href="#series" title="Link to this heading">#</a></h2>
<p>In many ways a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is like a Python dictionary, where the column names are the keys and the columns are the values.
You can select a column from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> using the bracket operator, with a string as the key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;BIRTHWGT_LB1&#39;</span><span class="p">]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.series.Series
</pre></div>
</div>
</div>
</div>
<p>The result is a <code class="docutils literal notranslate"><span class="pre">Series</span></code>, which is a Pandas type that represents a single column of data.
In this case the <code class="docutils literal notranslate"><span class="pre">Series</span></code> contains the birth weight, in pounds, for each live birth.</p>
<p><code class="docutils literal notranslate"><span class="pre">head</span></code> shows the first five values in the <code class="docutils literal notranslate"><span class="pre">Series</span></code>, the name of the <code class="docutils literal notranslate"><span class="pre">Series</span></code>, and the data type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    7.0
1    NaN
2    9.0
3    6.0
4    7.0
Name: BIRTHWGT_LB1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>One of the values is <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, which stands for “Not a Number”.
<code class="docutils literal notranslate"><span class="pre">NaN</span></code> is a special value used to indicate invalid or missing data.
In this example, the pregnancy did not end in live birth, so birth weight is inapplicable.</p>
<p><strong>Exercise:</strong>  The column <code class="docutils literal notranslate"><span class="pre">BIRTHWGT_OZ1</span></code> contains the ounces part of birth weight.
Select this column from <code class="docutils literal notranslate"><span class="pre">nsfg</span></code> and assign it to a new variable called <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.
Then display the first 5 elements of <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p>
<p><strong>Exercise:</strong> The Pandas types we have seen so far are <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="docutils literal notranslate"><span class="pre">Index</span></code>, and <code class="docutils literal notranslate"><span class="pre">Series</span></code>.  You can find the documentation of these types at:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Index</span></code>: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html</a></p></li>
</ul>
<p>This documentation can be overwhelming – I don’t recommend trying to read it all now.
But you might want to skim it so you know where to look later.</p>
</section>
<section id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Link to this heading">#</a></h2>
<p>At this point we have identified the columns we need to answer the question and assigned them to variables named <code class="docutils literal notranslate"><span class="pre">pounds</span></code> and <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;BIRTHWGT_LB1&#39;</span><span class="p">]</span>
<span class="n">ounces</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;BIRTHWGT_OZ1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Before we do anything with this data, we have to validate it.
One part of validation is confirming that we are interpreting the data correctly.
We can use the <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> method to see what values appear in <code class="docutils literal notranslate"><span class="pre">pounds</span></code> and how many times each value appears.
With <code class="docutils literal notranslate"><span class="pre">dropna=False</span></code>, it includes NaNs.
By default, the results are sorted with the highest count first, but we can use <code class="docutils literal notranslate"><span class="pre">sort_index</span></code> to sort them by value instead, with the lightest babies first and heaviest babies last.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BIRTHWGT_LB1
0.0        2
1.0       28
2.0       46
3.0       76
4.0      179
5.0      570
6.0     1644
7.0     2268
8.0     1287
9.0      396
10.0      82
11.0      17
12.0       2
13.0       1
14.0       1
98.0       2
99.0      89
NaN     2863
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>The values are in the left column and the counts are in the right column.
The most frequent values are 6-8 pounds, but there are some very light babies, a few very heavy babies, and two special values, 98, and 99.  According to the codebook, these values indicate that the respondent declined to answer the question (98) or did not know (99).</p>
<p>We can validate the results by comparing them to the codebook, which lists the values and their frequencies.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Value</p></th>
<th class="head text-left"><p>Label</p></th>
<th class="head text-right"><p>Total</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>.</p></td>
<td class="text-left"><p>INAPPLICABLE</p></td>
<td class="text-right"><p>2863</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>0-5</p></td>
<td class="text-left"><p>UNDER 6 POUNDS</p></td>
<td class="text-right"><p>901</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>6</p></td>
<td class="text-left"><p>6 POUNDS</p></td>
<td class="text-right"><p>1644</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>7</p></td>
<td class="text-left"><p>7 POUNDS</p></td>
<td class="text-right"><p>2268</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>8</p></td>
<td class="text-left"><p>8 POUNDS</p></td>
<td class="text-right"><p>1287</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>9-95</p></td>
<td class="text-left"><p>9 POUNDS OR MORE</p></td>
<td class="text-right"><p>499</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>98</p></td>
<td class="text-left"><p>Refused</p></td>
<td class="text-right"><p>2</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>99</p></td>
<td class="text-left"><p>Don’t know</p></td>
<td class="text-right"><p>89</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   | Total             | 9553  
</pre></div>
</div>
<p>The results from <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> agree with the codebook, so we can be confident that we are reading and interpreting the data correctly.</p>
<p><strong>Exercise:</strong> In <code class="docutils literal notranslate"><span class="pre">nsfg</span></code>, the <code class="docutils literal notranslate"><span class="pre">OUTCOME</span></code> column encodes the outcome of each pregnancy as shown below:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Value</p></th>
<th class="head text-left"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>1</p></td>
<td class="text-left"><p>Live birth</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>2</p></td>
<td class="text-left"><p>Induced abortion</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>3</p></td>
<td class="text-left"><p>Stillbirth</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>4</p></td>
<td class="text-left"><p>Miscarriage</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>5</p></td>
<td class="text-left"><p>Ectopic pregnancy</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>6</p></td>
<td class="text-left"><p>Current pregnancy</p></td>
</tr>
</tbody>
</table>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> to display the values in this column and how many times each value appears.  Are the results consistent with the codebook?</p>
</section>
<section id="summary-statistics">
<h2>Summary Statistics<a class="headerlink" href="#summary-statistics" title="Link to this heading">#</a></h2>
<p>Another way to validate the data is with <code class="docutils literal notranslate"><span class="pre">describe</span></code>, which computes statistics that summarize the data, like the mean, standard deviation, minimum, and maximum.
Here are the results for <code class="docutils literal notranslate"><span class="pre">pounds</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    6690.000000
mean        8.008819
std        10.771360
min         0.000000
25%         6.000000
50%         7.000000
75%         8.000000
max        99.000000
Name: BIRTHWGT_LB1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">count</span></code> is the number of values, not including <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.
<code class="docutils literal notranslate"><span class="pre">mean</span></code> and <code class="docutils literal notranslate"><span class="pre">std</span></code> are the mean and standard deviation.
<code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> are the minimum and maximum values, and in between are the 25th, 50th, and 75th percentiles.
The 50th percentile is the median.</p>
<p>The mean is about 8.05, but that doesn’t mean much because it includes the special values <code class="docutils literal notranslate"><span class="pre">98</span></code> and <code class="docutils literal notranslate"><span class="pre">99</span></code>.
Before we can really compute the mean, we have to replace those values with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> to identify them as missing data.
The <code class="docutils literal notranslate"><span class="pre">replace</span></code> method does what we want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pounds_clean</span> <span class="o">=</span> <span class="n">pounds</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">replace</span></code> takes a list of the values we want to replace and the value we want to replace them with.
<code class="docutils literal notranslate"><span class="pre">np.nan</span></code> means we are getting the special value <code class="docutils literal notranslate"><span class="pre">NaN</span></code> from the NumPy library, which is imported as <code class="docutils literal notranslate"><span class="pre">np</span></code>.
The result is a new <code class="docutils literal notranslate"><span class="pre">Series</span></code>, which I assign to <code class="docutils literal notranslate"><span class="pre">pounds_clean</span></code>.
If we run <code class="docutils literal notranslate"><span class="pre">describe</span></code> again, we see that <code class="docutils literal notranslate"><span class="pre">count</span></code> is smaller now because it includes only the valid values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds_clean</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    6599.000000
mean        6.754357
std         1.383268
min         0.000000
25%         6.000000
50%         7.000000
75%         8.000000
max        14.000000
Name: BIRTHWGT_LB1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The mean of the new <code class="docutils literal notranslate"><span class="pre">Series</span></code> is about 6.7 pounds.
Remember that the mean of the original <code class="docutils literal notranslate"><span class="pre">Series</span></code> was more than 8 pounds.
It makes a big difference when you remove a few 99-pound babies!</p>
<p>The effect on standard deviation is even more dramatic.
If we include the values <code class="docutils literal notranslate"><span class="pre">98</span></code> and <code class="docutils literal notranslate"><span class="pre">99</span></code>, the standard deviation is 10.8.
If we remove them – as we should – the standard deviation is 1.4.</p>
<p><strong>Exercise:</strong> Use <code class="docutils literal notranslate"><span class="pre">describe</span></code> to summarize <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.
Then use <code class="docutils literal notranslate"><span class="pre">replace</span></code> to replace the special values <code class="docutils literal notranslate"><span class="pre">98</span></code> and <code class="docutils literal notranslate"><span class="pre">99</span></code> with <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, and assign the result to <code class="docutils literal notranslate"><span class="pre">ounces_clean</span></code>.
Run <code class="docutils literal notranslate"><span class="pre">describe</span></code> again.
How much does this cleaning affect the results?</p>
</section>
<section id="series-arithmetic">
<h2>Series Arithmetic<a class="headerlink" href="#series-arithmetic" title="Link to this heading">#</a></h2>
<p>Now we want to combine <code class="docutils literal notranslate"><span class="pre">pounds</span></code> and <code class="docutils literal notranslate"><span class="pre">ounces</span></code> into a single <code class="docutils literal notranslate"><span class="pre">Series</span></code> that contains total birth weight.
With <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects, the arithmetic operators work elementwise, as they do with NumPy arrays.</p>
<p>So, to convert <code class="docutils literal notranslate"><span class="pre">pounds</span></code> to ounces, we can write <code class="docutils literal notranslate"><span class="pre">pounds</span> <span class="pre">*</span> <span class="pre">16</span></code>.
Then, to add in <code class="docutils literal notranslate"><span class="pre">ounces</span></code> we can write <code class="docutils literal notranslate"><span class="pre">pounds</span> <span class="pre">*</span> <span class="pre">16</span> <span class="pre">+</span> <span class="pre">ounces</span></code>.</p>
<p><strong>Exercise:</strong> Use <code class="docutils literal notranslate"><span class="pre">pounds_clean</span></code> and <code class="docutils literal notranslate"><span class="pre">ounces_clean</span></code> to compute the total birth weight expressed in kilograms (there are roughly 2.2 pounds per kilogram).  What is the mean birth weight in kilograms?</p>
</section>
<section id="histograms">
<h2>Histograms<a class="headerlink" href="#histograms" title="Link to this heading">#</a></h2>
<p>Let’s get back to the original question: what is the average birth weight for babies in the U.S.?<br />
As an answer we <em>could</em> take the results from the previous section and compute the mean:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds_clean</span> <span class="o">=</span> <span class="n">pounds</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">ounces_clean</span> <span class="o">=</span> <span class="n">ounces</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="n">birth_weight</span> <span class="o">=</span> <span class="n">pounds_clean</span> <span class="o">+</span> <span class="n">ounces_clean</span> <span class="o">/</span> <span class="mi">16</span>
<span class="n">birth_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.180217889908257
</pre></div>
</div>
</div>
</div>
<p>But it is risky to compute a summary statistic, like the mean, before we look at the whole distribution of values.
A <strong>distribution</strong> is a set of possible values and their frequencies.
One way to visualize a distribution is a <strong>histogram</strong>, which shows values on the x-axis and their frequencies on the y-axis.
<code class="docutils literal notranslate"><span class="pre">Series</span></code> provides a <code class="docutils literal notranslate"><span class="pre">hist</span></code> method that makes histograms, and we can use Pyplot to label the axes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">birth_weight</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Birth weight in pounds&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of live births&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of U.S. birth weight&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/487a0082eabb31ec583d826d5506962105f363183d4f34b040153244606f4ddb.png" src="_images/487a0082eabb31ec583d826d5506962105f363183d4f34b040153244606f4ddb.png" />
</div>
</div>
<p>The keyword argument, <code class="docutils literal notranslate"><span class="pre">bins</span></code>, tells <code class="docutils literal notranslate"><span class="pre">hist</span></code> to divide the range of weights into 30 intervals, called <strong>bins</strong>, and count how many values fall in each bin.
The x-axis is birth weight in pounds; the y-axis is the number of births in each bin.</p>
<p>The distribution looks like a bell curve, but the tail is longer on the left than on the right – that is, there are more light babies than heavy babies.
That makes sense, because the distribution includes some babies that were born preterm.</p>
<p><strong>Exercise:</strong> <code class="docutils literal notranslate"><span class="pre">hist</span></code> takes keyword arguments that specify the type and appearance of the histogram.
Read the documentation of <code class="docutils literal notranslate"><span class="pre">hist</span></code> at <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.Series.hist.html">https://pandas.pydata.org/docs/reference/api/pandas.Series.hist.html</a> and see if you can figure out how to plot the histogram as an unfilled line against a background with no grid lines.</p>
<p><strong>Exercise:</strong> The NSFG dataset includes a column called <code class="docutils literal notranslate"><span class="pre">AGECON</span></code> that records a woman’s age at conception for each pregnancy.
Select this column from the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and plot the histogram of the values with 20 bins.
Label the axes and add a title.</p>
</section>
<section id="boolean-series">
<h2>Boolean Series<a class="headerlink" href="#boolean-series" title="Link to this heading">#</a></h2>
<p>We have seen that the distribution of birth weights is <strong>skewed</strong> to the left – that is, the left tail extends farther from the center than the right tail.
That’s because preterm babies tend to be lighter.
To see which babies are preterm, we can use the <code class="docutils literal notranslate"><span class="pre">PRGLNGTH</span></code> column, which records pregnancy length in weeks.
A baby is considered preterm if it is born prior to the 37th week of pregnancy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;PRGLNGTH&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">)</span>
<span class="n">preterm</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtype(&#39;bool&#39;)
</pre></div>
</div>
</div>
</div>
<p>When you compare a <code class="docutils literal notranslate"><span class="pre">Series</span></code> to a value, the result is a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> – that is, a <code class="docutils literal notranslate"><span class="pre">Series</span></code> where each element is a Boolean value, <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>.
In this case, it’s <code class="docutils literal notranslate"><span class="pre">True</span></code> for each preterm baby and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.
We can use <code class="docutils literal notranslate"><span class="pre">head</span></code> to see the first 5 elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    False
1     True
2    False
3    False
4    False
Name: PRGLNGTH, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>For a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code>, the <code class="docutils literal notranslate"><span class="pre">sum</span></code>  method treats <code class="docutils literal notranslate"><span class="pre">True</span></code> as 1 and <code class="docutils literal notranslate"><span class="pre">False</span></code> as 0, so the result is the number of <code class="docutils literal notranslate"><span class="pre">True</span></code> values, which is the number of preterm babies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3675
</pre></div>
</div>
</div>
</div>
<p>If you compute the mean of a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code>, the result the <em>fraction</em> of <code class="docutils literal notranslate"><span class="pre">True</span></code> values.
In this case, it’s about 0.38 – which means about 38% of the pregnancies are less than 37 weeks in duration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.38469590704490736
</pre></div>
</div>
</div>
</div>
<p>However, this result is misleading because it includes all pregnancy outcomes, not just live births.
We can use the <code class="docutils literal notranslate"><span class="pre">OUTCOME</span></code> column to create another Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> to indicate which pregnancies ended in live birth.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">live</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;OUTCOME&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">live</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7006176070344394
</pre></div>
</div>
</div>
</div>
<p>Now we can use the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator, which represents the logical AND operation, to identify pregnancies where the outcome is a live birth <em>and</em> preterm:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">live_preterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">live</span> <span class="o">&amp;</span> <span class="n">preterm</span><span class="p">)</span>
<span class="n">live_preterm</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.08929132209777034
</pre></div>
</div>
</div>
</div>
<p>About 9% of all pregnancies resulted in a preterm live birth.</p>
<p>The other common logical operators that work with <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>, which represents the logical OR operation – for example, <code class="docutils literal notranslate"><span class="pre">live</span> <span class="pre">|</span> <span class="pre">preterm</span></code> is true if either <code class="docutils literal notranslate"><span class="pre">live</span></code> is true, or <code class="docutils literal notranslate"><span class="pre">preterm</span></code> is true, or both.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~</span></code>, which represents the logical NOT operation – for example, <code class="docutils literal notranslate"><span class="pre">~live</span></code> is true if <code class="docutils literal notranslate"><span class="pre">live</span></code> not true.</p></li>
</ul>
<p>The logical operators treat <code class="docutils literal notranslate"><span class="pre">NaN</span></code> the same as <code class="docutils literal notranslate"><span class="pre">False</span></code>, so you should be careful about using the NOT operator with a Series that contains <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values.
For example, <code class="docutils literal notranslate"><span class="pre">~preterm</span></code> would include not just full term pregnancies, but also pregnancies with unknown duration.</p>
<p><strong>Exercise:</strong> Of all pregnancies, what fraction are live births at full term (37 weeks or more)?
Of all live births, what fraction are full term?</p>
</section>
<section id="filtering-data">
<h2>Filtering Data<a class="headerlink" href="#filtering-data" title="Link to this heading">#</a></h2>
<p>We can use a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> as a filter – that is, we can select only rows that satisfy a condition or meet some criterion.
For example, we can use <code class="docutils literal notranslate"><span class="pre">preterm</span></code> and the bracket operator to select values from <code class="docutils literal notranslate"><span class="pre">birth_weight</span></code>, so <code class="docutils literal notranslate"><span class="pre">preterm_weight</span></code> gets birth weights for preterm babies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm_weight</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="p">[</span><span class="n">preterm</span><span class="p">]</span>
<span class="n">preterm_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.480958781362007
</pre></div>
</div>
</div>
</div>
<p>To select full-term babies, we can create a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fullterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;PRGLNGTH&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">37</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And use it to select birth weights for full term babies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_term_weight</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="p">[</span><span class="n">fullterm</span><span class="p">]</span>
<span class="n">full_term_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.429609416096791
</pre></div>
</div>
</div>
</div>
<p>As expected, full term babies are heavier, on average, than preterm babies.
To be more explicit, we could also limit the results to live births, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_term_weight</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="p">[</span><span class="n">live</span> <span class="o">&amp;</span> <span class="n">fullterm</span><span class="p">]</span>
<span class="n">full_term_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.429609416096791
</pre></div>
</div>
</div>
</div>
<p>But in this case we get the same result because <code class="docutils literal notranslate"><span class="pre">birth_weight</span></code> is only valid for live births.</p>
<p><strong>Exercise:</strong> Let’s see if there is a difference in weight between single births and multiple births (twins, triplets, etc.).
The column <code class="docutils literal notranslate"><span class="pre">NBRNALIV</span></code> represents the number of babies born alive from a single pregnancy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrnaliv</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;NBRNALIV&#39;</span><span class="p">]</span>
<span class="n">nbrnaliv</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NBRNALIV
1.0    6573
2.0     111
3.0       6
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">nbrnaliv</span></code> and <code class="docutils literal notranslate"><span class="pre">live</span></code> to create a Boolean series called <code class="docutils literal notranslate"><span class="pre">multiple</span></code> that is true for multiple live births.
Of all live births, what fraction are multiple births?</p>
<p><strong>Exercise:</strong> Make a Boolean series called <code class="docutils literal notranslate"><span class="pre">single</span></code> that is true for single live births.
Of all single births, what fraction are preterm?
Of all multiple births, what fraction are preterm?</p>
<p><strong>Exercise:</strong> What is the average birth weight for live, single, full-term births?</p>
</section>
<section id="weighted-means">
<h2>Weighted Means<a class="headerlink" href="#weighted-means" title="Link to this heading">#</a></h2>
<p>We are almost done, but there’s one more problem we have to solve: oversampling.
The NSFG sample is not exactly representative of the U.S. population.
By design, some groups are more likely to appear in the sample than others – that is, they are <strong>oversampled</strong>.
Oversampling helps to ensure that you have enough people in every group to get reliable statistics, but it makes data analysis a little more complicated.</p>
<p>Each pregnancy in the dataset has a <strong>sampling weight</strong> that indicates how many pregnancies it represents.
In <code class="docutils literal notranslate"><span class="pre">nsfg</span></code>, the sampling weight is stored in a column named <code class="docutils literal notranslate"><span class="pre">wgt2015_2017</span></code>.
Here’s what it looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampling_weight</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;WGT2015_2017&#39;</span><span class="p">]</span>
<span class="n">sampling_weight</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count      9553.000000
mean      13337.425944
std       16138.878271
min        1924.916000
25%        4575.221221
50%        7292.490835
75%       15724.902673
max      106774.400000
Name: WGT2015_2017, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The median value (<code class="docutils literal notranslate"><span class="pre">50</span></code>th percentile) in this column is about <code class="docutils literal notranslate"><span class="pre">7292</span></code>, which means that a pregnancy with that weight represents <code class="docutils literal notranslate"><span class="pre">7292</span></code> total pregnancies in the population.
But the range of values is wide, so some rows represent many more pregnancies than others.</p>
<p>To take these weights into account, we can compute a <strong>weighted mean</strong>.  Here are the steps:</p>
<ol class="arabic simple">
<li><p>Multiply the birth weights for each pregnancy by the sampling weights and add up the products.</p></li>
<li><p>Add up the sampling weights.</p></li>
<li><p>Divide the first sum by the second.</p></li>
</ol>
<p>To do this correctly, we have to be careful with missing data.
To help with that, we’ll use two <code class="docutils literal notranslate"><span class="pre">Series</span></code> methods, <code class="docutils literal notranslate"><span class="pre">isna</span></code> and <code class="docutils literal notranslate"><span class="pre">notna</span></code>.
<code class="docutils literal notranslate"><span class="pre">isna</span></code> returns a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> that is <code class="docutils literal notranslate"><span class="pre">True</span></code> where the corresponding value is <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
<span class="n">missing</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3013
</pre></div>
</div>
</div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">birth_weight</span></code> there are <code class="docutils literal notranslate"><span class="pre">3013</span></code> missing values (mostly for pregnancies that did not end in live birth).
<code class="docutils literal notranslate"><span class="pre">notna</span></code> returns a Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> that is <code class="docutils literal notranslate"><span class="pre">True</span></code> where the corresponding value is <em>not</em> <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
<span class="n">valid</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6540
</pre></div>
</div>
</div>
</div>
<p>We can combine <code class="docutils literal notranslate"><span class="pre">valid</span></code> with the other Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> we have computed to identify single, full term, live births with valid birth weights.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbrnaliv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">selected</span> <span class="o">=</span> <span class="n">valid</span> <span class="o">&amp;</span> <span class="n">live</span> <span class="o">&amp;</span> <span class="n">single</span> <span class="o">&amp;</span> <span class="n">fullterm</span>
<span class="n">selected</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5648
</pre></div>
</div>
</div>
</div>
<p>You can finish off this computation as an exercise.</p>
<p><strong>Exercise:</strong> Use <code class="docutils literal notranslate"><span class="pre">selected</span></code>, <code class="docutils literal notranslate"><span class="pre">birth_weight</span></code>, and <code class="docutils literal notranslate"><span class="pre">sampling_weight</span></code> to compute the weighted mean of birth weight for live, single, full term births.
You should find that the weighted mean is a little higher than the unweighted mean we computed in the previous section.
That’s because the groups that are oversampled in the NSFG tend to have lighter babies, on average.</p>
</section>
<section id="making-an-extract">
<h2>Making an Extract<a class="headerlink" href="#making-an-extract" title="Link to this heading">#</a></h2>
<p>The NSFG dataset is large, and reading a fixed-width file is relatively slow.
So now that we’ve read it, let’s save a smaller version in a more efficient format.
When we come back to this dataset in Chapter 13, here are the columns we’ll need.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CASEID&#39;</span><span class="p">,</span> <span class="s1">&#39;OUTCOME&#39;</span><span class="p">,</span> <span class="s1">&#39;BIRTHWGT_LB1&#39;</span><span class="p">,</span> <span class="s1">&#39;BIRTHWGT_OZ1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;PRGLNGTH&#39;</span><span class="p">,</span> <span class="s1">&#39;NBRNALIV&#39;</span><span class="p">,</span> <span class="s1">&#39;AGECON&#39;</span><span class="p">,</span> <span class="s1">&#39;AGEPREG&#39;</span><span class="p">,</span> <span class="s1">&#39;BIRTHORD&#39;</span><span class="p">,</span>
             <span class="s1">&#39;HPAGELB&#39;</span><span class="p">,</span> <span class="s1">&#39;WGT2015_2017&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>And here’s how we can select just those columns from the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span>
<span class="n">subset</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9553, 11)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> provides several methods for writing data to a file – the one we’ll use is <code class="docutils literal notranslate"><span class="pre">to_hdf</span></code>, which creates an HDF file.
The parameters are the name of the new file, the name of the object we’re storing in the file, and the compression level, which determines how effectively the data are compressed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;nsfg.hdf&#39;</span>
<span class="n">nsfg</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;nsfg&#39;</span><span class="p">,</span> <span class="n">complevel</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is much smaller than the original fixed-width file, and faster to read.
We can read it back like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;nsfg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>This chapter poses what seems like a simple question: what is the average birth weight of babies in the United States?</p>
<p>To answer it, we found an appropriate dataset and downloaded the files.
We used Pandas to read the files and create a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.
Then we validated the data and dealt with special values and missing data.
To explore the data, we used <code class="docutils literal notranslate"><span class="pre">value_counts</span></code>, <code class="docutils literal notranslate"><span class="pre">hist</span></code>, <code class="docutils literal notranslate"><span class="pre">describe</span></code>, and other methods.
And to select relevant data, we used Boolean <code class="docutils literal notranslate"><span class="pre">Series</span></code> objects.</p>
<p>Along the way, we had to think more about the question.
What do we mean by “average”, and which babies should we include?
Should we include all live births or exclude preterm babies or multiple births?</p>
<p>And we had to think about the sampling process.
By design, the NSFG respondents are not representative of the U.S. population, but we can use sampling weights to correct for this effect.</p>
<p>Even a simple question can be a challenging data science project.</p>
<p>A note on vocabulary: In a dataset like the one we used in this chapter, we could say that each column represents a “variable”, and what we called column names might also be called variable names.
I avoided that use of the term because it might be confusing to say that we select a “variable” from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and assign it to a Python variable.
But you might see this use of the term elsewhere, so I thought I would mention it.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="06_plotting.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Plotting</p>
      </div>
    </a>
    <a class="right-next"
       href="08_distributions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Distributions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data">Reading the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series">Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">Validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-statistics">Summary Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series-arithmetic">Series Arithmetic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#histograms">Histograms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#boolean-series">Boolean Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-data">Filtering Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#weighted-means">Weighted Means</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-an-extract">Making an Extract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>