
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dataframes &#8212; Elements of Data Science</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Distributions" href="08_distributions.html" />
    <link rel="prev" title="Plotting" href="06_plotting.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Elements of Data Science</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Elements of Data Science
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_variables.html">
   Variables and values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_times.html">
   Times and places
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_arrays.html">
   Lists and arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_loops.html">
   Loops and files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_dictionaries.html">
   Dictionaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_plotting.html">
   Plotting
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Dataframes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_distributions.html">
   Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_relationships.html">
   Relationships
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_regression.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_inference.html">
   Inference
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/07_dataframes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/AllenDowney/ElementsOfDataScience"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/AllenDowney/ElementsOfDataScience/master?urlpath=tree/07_dataframes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframes-and-series">
   DataFrames and Series
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#series">
   Series
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation">
   Validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-statistics">
   Summary statistics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#series-arithmetic">
   Series arithmetic
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#histograms">
   Histograms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#boolean-series">
   Boolean series
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtering">
   Filtering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resampling">
   Resampling
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dataframes">
<h1>Dataframes<a class="headerlink" href="#dataframes" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ElementsOfDataScience/blob/master/07_dataframes.ipynb">Click here to run this notebook on Colab</a> or
<a class="reference external" href="https://github.com/AllenDowney/ElementsOfDataScience/raw/master/07_dataframes.ipynb">click here to download it</a>.</p>
<p>This chapter introduces Pandas, which is a powerful library for working with data.  Pandas provides functions for reading data from files, and it provides two new types for working with data, DataFrames and Series.</p>
<p>We’ll use these tools to estimate the average birth weight of babies in the U.S.  This example demonstrates the important steps in almost any data science project:</p>
<ol class="simple">
<li><p>Identifying data that can answer a question.</p></li>
<li><p>Obtaining the data and loading it in Python.</p></li>
<li><p>Checking the data and dealing with errors.</p></li>
<li><p>Selecting the relevant subsets from the data.</p></li>
<li><p>Using histograms to visualize a distribution of values.</p></li>
<li><p>Using summary statistics to describe the data in a way that best answers the question.</p></li>
<li><p>Considering possible sources of error and limitations in our conclusions.</p></li>
</ol>
<p>Because this chapter presents a data science project from end to end, it is a little longer than some of the previous chapters.  So, hang in there!</p>
<div class="section" id="dataframes-and-series">
<h2>DataFrames and Series<a class="headerlink" href="#dataframes-and-series" title="Permalink to this headline">¶</a></h2>
<p>The fundamental goal of data science is to use data to answer questions and guide decision making.</p>
<p>As an example, we’ll start with a simple question: what is the average birth weight of babies in the United States?</p>
<p>To answer a question like this, we have to find an appropriate dataset or run an experiment to collect it.  Then we have to get the data into our development environment and prepare it for analysis, which involves cleaning and validation.</p>
<p>For this question we’ll use data from the <a class="reference external" href="https://www.cdc.gov/nchs/nsfg/index.htm">National Survey of Family Growth</a>, which is available from the National Center for Health Statistics.</p>
<p>Their 2013-2015 dataset includes information about a sample of women in the U.S. and their children.</p>
<p>The Python library we’ll use to read and analyze data is Pandas, which we’ll import as <code class="docutils literal notranslate"><span class="pre">pd</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>Pandas can read data in most common formats, including CSV, Excel, and the format the NSFG data is in, HDF5.  <a class="reference external" href="https://en.wikipedia.org/wiki/Hierarchical_Data_Format">You can read about HDF here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;nsfg.hdf5&#39;</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">nsfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.frame.DataFrame
</pre></div>
</div>
</div>
</div>
<p>The result from <code class="docutils literal notranslate"><span class="pre">read_hdf()</span></code> is a DataFrame, which is the primary type Pandas uses to store data.</p>
<p>For each woman who participated in the survey, this DataFrame has one row for each pregnancy and one column for each survey question.</p>
<p>DataFrame has a method called <code class="docutils literal notranslate"><span class="pre">head()</span></code> that shows the first 5 rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>caseid</th>
      <th>outcome</th>
      <th>birthwgt_lb1</th>
      <th>birthwgt_oz1</th>
      <th>prglngth</th>
      <th>nbrnaliv</th>
      <th>agecon</th>
      <th>agepreg</th>
      <th>birthord</th>
      <th>hpagelb</th>
      <th>wgt2013_2015</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>60418</td>
      <td>1</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>40</td>
      <td>1.0</td>
      <td>2000</td>
      <td>2075.0</td>
      <td>1.0</td>
      <td>22.0</td>
      <td>3554.964843</td>
    </tr>
    <tr>
      <th>1</th>
      <td>60418</td>
      <td>1</td>
      <td>4.0</td>
      <td>12.0</td>
      <td>36</td>
      <td>1.0</td>
      <td>2291</td>
      <td>2358.0</td>
      <td>2.0</td>
      <td>25.0</td>
      <td>3554.964843</td>
    </tr>
    <tr>
      <th>2</th>
      <td>60418</td>
      <td>1</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>36</td>
      <td>1.0</td>
      <td>3241</td>
      <td>3308.0</td>
      <td>3.0</td>
      <td>52.0</td>
      <td>3554.964843</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60419</td>
      <td>6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>33</td>
      <td>NaN</td>
      <td>3650</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2484.535358</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60420</td>
      <td>1</td>
      <td>8.0</td>
      <td>13.0</td>
      <td>41</td>
      <td>1.0</td>
      <td>2191</td>
      <td>2266.0</td>
      <td>1.0</td>
      <td>24.0</td>
      <td>2903.782914</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>DataFrames provide “attributes” and “methods”.</p>
<p>A method is a function that is associated with a particular type.  For example, in a previous chapter, we used the <code class="docutils literal notranslate"><span class="pre">split</span></code> method, which is a function that works with strings.</p>
<p>An attribute is a variable associated with a particular type.  For example, DataFrame has an attribute called <code class="docutils literal notranslate"><span class="pre">shape</span></code>, which is the number of rows and columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9358, 11)
</pre></div>
</div>
</div>
</div>
<p>There are 9358 rows in this dataset, one for each pregnancy, and 11 columns, one for each survey question.</p>
<p>DataFrame also has an attribute called <code class="docutils literal notranslate"><span class="pre">columns</span></code>, which contains the column names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;caseid&#39;, &#39;outcome&#39;, &#39;birthwgt_lb1&#39;, &#39;birthwgt_oz1&#39;, &#39;prglngth&#39;,
       &#39;nbrnaliv&#39;, &#39;agecon&#39;, &#39;agepreg&#39;, &#39;birthord&#39;, &#39;hpagelb&#39;, &#39;wgt2013_2015&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>The column names are stored in an <code class="docutils literal notranslate"><span class="pre">Index</span></code>, which is another Pandas type, similar to a list:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">nsfg</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.base.Index
</pre></div>
</div>
</div>
</div>
<p>Based on the column names, you might be able to guess what some of the variables are, but in general you have to read the documentation.</p>
<p><strong>Exercise:</strong> When you work with datasets like the NSFG, it is important to read the documentation carefully. If you interpret a variable incorrectly, you can generate nonsense results and never realize it. So, before we start looking at data, let’s get familiar with the NSFG codebook, which describes every variable.</p>
<ul class="simple">
<li><p>Follow <a class="reference external" href="https://www.icpsr.umich.edu/icpsradmin/nsfg/index?studyNumber=9999">this link</a> to get to the interactive codebook.</p></li>
<li><p>Type “birthweight” in the search field, un-select the checkbox that says “Search variable name only”, and press “Search”.  You should see a list of variables related to birthweight.</p></li>
<li><p>Click on “BIRTHWGT_LB1” and read the documentation of this variable.</p></li>
</ul>
<p>What is the most common value of this variable?</p>
</div>
<div class="section" id="series">
<h2>Series<a class="headerlink" href="#series" title="Permalink to this headline">¶</a></h2>
<p>In many ways a DataFrame is like a Python dictionary, where the column names are the keys and the columns are the values.  You can select a column from a DataFrame using the bracket operator, with a string as the key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;birthwgt_lb1&#39;</span><span class="p">]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.series.Series
</pre></div>
</div>
</div>
</div>
<p>The result is a Series, which is another Pandas type.</p>
<p>In this case the Series contains the birth weights, in pounds, of the live births (or in the case of multiple births, the first baby).</p>
<p><code class="docutils literal notranslate"><span class="pre">head()</span></code> shows the first five values in the series, the name of the series, and the datatype:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    5.0
1    4.0
2    5.0
3    NaN
4    8.0
Name: birthwgt_lb1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Remember that <code class="docutils literal notranslate"><span class="pre">head</span></code> is a method, not an attribute; to call it, we have to use parentheses, <code class="docutils literal notranslate"><span class="pre">()</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">float64</span></code> means that these values are 64-bit floating-point numbers.</p>
<p>One of the values is <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, which stands for “Not a Number”.  NaN is a special value used to indicate invalid or missing data.  In this example, the pregnancy did not end in live birth, so birth weight is inapplicable.</p>
<p><strong>Exercise:</strong>  The variable <code class="docutils literal notranslate"><span class="pre">birthwgt_oz1</span></code> contains the ounces part of birth weight.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.icpsr.umich.edu/icpsradmin/nsfg/variable/815971?studyNumber=9999">Read the documentation of this variable</a>.  What is the “universe” of this variable; that is, when is it applicable?</p></li>
<li><p>Select the column <code class="docutils literal notranslate"><span class="pre">'birthwgt_oz1'</span></code> from the <code class="docutils literal notranslate"><span class="pre">nsfg</span></code> DataFrame and assign it to a new variable called <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p></li>
<li><p>Display the first 5 elements of <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p></li>
</ul>
<p><strong>Exercise:</strong> The Pandas types we have seen so far at DataFrame, Index, and Series.  You can find the documentation of these types at:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">DataFrame</a></p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html">Index</a></p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html">Series</a></p></li>
</ul>
<p>For beginners, this documentation can be overwhelming.  I don’t recommend trying to read it all now.  But you might want to skim it so you know where to look later.</p>
<p>For each type, the documentation lists the associated attributes (which are like variables) and methods (which are like functions).</p>
</div>
<div class="section" id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h2>
<p>At this point we have identified the columns we need to answer the question.</p>
<ul class="simple">
<li><p>I’ll select <code class="docutils literal notranslate"><span class="pre">birthwgt_lb1</span></code>, which contains the pound part of birth weight, and assign it to <code class="docutils literal notranslate"><span class="pre">pounds</span></code>.</p></li>
<li><p>And I’ll select <code class="docutils literal notranslate"><span class="pre">birthwgt_oz1</span></code>, which contains the ounce part of birth weight, and assign it to <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ounces</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;birthwgt_oz1&#39;</span><span class="p">]</span>
<span class="n">pounds</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;birthwgt_lb1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Before we do anything with this data, we have to validate it.  One part of validation is confirming that we are interpreting the data correctly.</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> method to see what values appear in <code class="docutils literal notranslate"><span class="pre">pounds</span></code> and how many times each value appears.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>By default, the results are sorted with the most frequent value first, so I use <code class="docutils literal notranslate"><span class="pre">sort_index</span></code> to sort them by value instead, with the lightest babies first and heaviest babies last.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0        6
1.0       34
2.0       47
3.0       67
4.0      196
5.0      586
6.0     1666
7.0     2146
8.0     1168
9.0      363
10.0      82
11.0      17
12.0       7
13.0       2
14.0       2
17.0       1
98.0       1
99.0      94
Name: birthwgt_lb1, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>As we’d expect, the most frequent values are 6-8 pounds, but there are some very light babies, a few very heavy babies, and two special values, 98, and 99.  <a class="reference external" href="https://www.icpsr.umich.edu/icpsradmin/nsfg/variable/815970?studyNumber=9999">According to the codebook</a>, these values indicate that the respondent declined to answer the question (98) or did not know (99).</p>
<p>We can validate the results by comparing them to the codebook, which lists the values and their frequencies.  The results here agree with the codebook, so we have some confidence that we are reading and interpreting the data correctly.</p>
<p><strong>Exercise:</strong> In the <code class="docutils literal notranslate"><span class="pre">nsfg</span></code> DataFrame, the column <code class="docutils literal notranslate"><span class="pre">'outcome'</span></code> encodes the outcome of each pregnancy as shown below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Live birth</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Induced abortion</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Stillbirth</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Miscarriage</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Ectopic pregnancy</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Current pregnancy</p></td>
</tr>
</tbody>
</table>
<p>Use <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> to display the values in this column and how many times each value appears.  Compare the results to the codebook, <a class="reference external" href="https://www.icpsr.umich.edu/icpsradmin/nsfg/variable/816124?studyNumber=9999">which you can find here</a>.  According to the codebook, how many live births are described in this dataset?  How many did you find in the DataFrame?</p>
</div>
<div class="section" id="summary-statistics">
<h2>Summary statistics<a class="headerlink" href="#summary-statistics" title="Permalink to this headline">¶</a></h2>
<p>Another way to validate the data is with <code class="docutils literal notranslate"><span class="pre">describe</span></code>, which computes summary statistics like the mean, standard deviation, min, and max.</p>
<p>Here are the results for <code class="docutils literal notranslate"><span class="pre">pounds</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    6485.000000
mean        8.055204
std        11.178893
min         0.000000
25%         6.000000
50%         7.000000
75%         8.000000
max        99.000000
Name: birthwgt_lb1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">count</span></code> is the number of values, not including <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">mean</span></code> and <code class="docutils literal notranslate"><span class="pre">std</span></code> are the mean and standard deviation.</p>
<p><code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> are the minimum and maximum values, and in between are the 25th, 50th, and 75th percentiles.  The 50th percentile is the median.</p>
<p>The mean is about 8.05, but that doesn’t mean much because it includes the special values 98 and 99.  Before we can really compute the mean, we have to replace those values with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> to identify them as missing data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">replace()</span></code> method does what we want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pounds_clean</span> <span class="o">=</span> <span class="n">pounds</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">replace</span></code> takes a list of the values we want to replace and the value we want to replace them with.  <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> means we are getting the special value <code class="docutils literal notranslate"><span class="pre">NaN</span></code> from the NumPy library, which is imported as <code class="docutils literal notranslate"><span class="pre">np</span></code>.</p>
<p>The result from <code class="docutils literal notranslate"><span class="pre">replace()</span></code> is a new Series, which I assign to <code class="docutils literal notranslate"><span class="pre">pounds_clean</span></code>.</p>
<p>If we run <code class="docutils literal notranslate"><span class="pre">describe</span></code> again, we see that <code class="docutils literal notranslate"><span class="pre">count</span></code> includes only the valid values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds_clean</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    6390.000000
mean        6.703286
std         1.429265
min         0.000000
25%         6.000000
50%         7.000000
75%         8.000000
max        17.000000
Name: birthwgt_lb1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The mean of the new series is about 6.7 pounds.</p>
<p>Remember that the mean of the original series was more than 8 pounds.</p>
<p>It makes a big difference when you remove a few 99-pound babies!</p>
<p><strong>Exercise:</strong> Use <code class="docutils literal notranslate"><span class="pre">describe</span></code> to summarize <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p>
<p>Then use <code class="docutils literal notranslate"><span class="pre">replace</span></code> to replace the special values 98 and 99 with NaN, and assign the result to <code class="docutils literal notranslate"><span class="pre">ounces_clean</span></code>.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">describe</span></code> again.  How much does this cleaning affect the results?</p>
<p><strong>Exercise:</strong> In the <code class="docutils literal notranslate"><span class="pre">nsfg</span></code> DataFrame, the column <code class="docutils literal notranslate"><span class="pre">'nbrnaliv'</span></code> records the number of babies born alive at the end of each pregnancy.</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> to view the responses, you’ll see that the value <code class="docutils literal notranslate"><span class="pre">8</span></code> appears once, and if you <a class="reference external" href="https://www.icpsr.umich.edu/icpsradmin/nsfg/variable/815953?studyNumber=9999">consult the codebook</a>, you’ll see that this value indicates that the respondent refused to answer the question.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">replace</span></code> to replace this value with <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>, then display the responses again and confirm that they are consistent with the codebook.</p>
</div>
<div class="section" id="series-arithmetic">
<h2>Series arithmetic<a class="headerlink" href="#series-arithmetic" title="Permalink to this headline">¶</a></h2>
<p>Now we want to combine <code class="docutils literal notranslate"><span class="pre">pounds</span></code> and <code class="docutils literal notranslate"><span class="pre">ounces</span></code> into a single Series that contains total birth weight.</p>
<p>Arithmetic operators work with Series objects; so, for example, to convert <code class="docutils literal notranslate"><span class="pre">pounds</span></code> to ounces, we could write</p>
<p><code class="docutils literal notranslate"><span class="pre">pounds</span> <span class="pre">*</span> <span class="pre">16</span></code></p>
<p>Then we could add in <code class="docutils literal notranslate"><span class="pre">ounces</span></code> like this</p>
<p><code class="docutils literal notranslate"><span class="pre">pounds</span> <span class="pre">*</span> <span class="pre">16</span> <span class="pre">+</span> <span class="pre">ounces</span></code></p>
<p><strong>Exercise:</strong> Use <code class="docutils literal notranslate"><span class="pre">pounds_clean</span></code> and <code class="docutils literal notranslate"><span class="pre">ounces_clean</span></code> to compute the total birth weight expressed in kilograms (there are roughly 2.2 pounds per kilogram).  What is the mean birth weight in kilograms?</p>
<p><strong>Exercise:</strong> For each pregnancy in the NSFG dataset, the variable <code class="docutils literal notranslate"><span class="pre">'agecon'</span></code> encodes the respondent’s age at conception, and <code class="docutils literal notranslate"><span class="pre">'agepreg'</span></code> the respondent’s age at the end of the pregnancy.</p>
<p>Both variables are recorded as integers with two implicit decimal places, so the value <code class="docutils literal notranslate"><span class="pre">2575</span></code> means that the respondent’s age was <code class="docutils literal notranslate"><span class="pre">25.75</span></code>.</p>
<ul class="simple">
<li><p>Read the documentation of these variables.  Are there any special values we have to deal with?</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">'agecon'</span></code> and <code class="docutils literal notranslate"><span class="pre">'agepreg'</span></code>, divide them by <code class="docutils literal notranslate"><span class="pre">100</span></code>, and assign them to variables named <code class="docutils literal notranslate"><span class="pre">agecon</span></code> and <code class="docutils literal notranslate"><span class="pre">agepreg</span></code>.</p></li>
<li><p>Compute the difference, which is an estimate of the duration of the pregnancy.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.describe()</span></code> to compute the mean duration and other summary statistics.</p></li>
</ul>
<p>If the mean length of pregnancy seems short, remember that this dataset includes all pregnancies, not just the ones that ended in live birth.</p>
</div>
<div class="section" id="histograms">
<h2>Histograms<a class="headerlink" href="#histograms" title="Permalink to this headline">¶</a></h2>
<p>Let’s get back to the original queston: what is the average birth weight for babies in the U.S.?</p>
<p>As an answer we <em>could</em> take the results from the previous section and compute the mean:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pounds_clean</span> <span class="o">=</span> <span class="n">pounds</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">ounces_clean</span> <span class="o">=</span> <span class="n">ounces</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="n">birth_weight</span> <span class="o">=</span> <span class="n">pounds_clean</span> <span class="o">+</span> <span class="n">ounces_clean</span> <span class="o">/</span> <span class="mi">16</span>
<span class="n">birth_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.120977576711251
</pre></div>
</div>
</div>
</div>
<p>But it is risky to compute a summary statistic, like the mean, before we look at the whole distribution of values.</p>
<p>A “distribution” is a set of possible values and their frequencies.  One way to visualize a distribution is a histogram, which shows values on the <code class="docutils literal notranslate"><span class="pre">x</span></code> axis and their frequencies on the <code class="docutils literal notranslate"><span class="pre">y</span></code> axis.</p>
<p>We’ll use Pyplot to make histograms; as usual, we import it with the short name <code class="docutils literal notranslate"><span class="pre">plt</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>Pyplot provides <code class="docutils literal notranslate"><span class="pre">hist</span></code>, which takes a Series and plots a histogram; that is, it shows the values and how often they appear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">birth_weight</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Birth weight in pounds&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of live births&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of U.S. birth weight&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07_dataframes_61_0.png" src="_images/07_dataframes_61_0.png" />
</div>
</div>
<p>Pyplot doesn’t work with NaNs, so we have to use <code class="docutils literal notranslate"><span class="pre">dropna</span></code>, which makes a new Series that contains only the valid values.</p>
<p>The second argument, <code class="docutils literal notranslate"><span class="pre">bins</span></code>, tells <code class="docutils literal notranslate"><span class="pre">hist</span></code> to divide the range of weights into 30 intervals, called “bins”, and count how many values fall in each bin.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">x</span></code> axis is birth weight in pounds, divided into 30 bins.  The <code class="docutils literal notranslate"><span class="pre">y</span></code> axis is the number of births in each bin.</p>
<p>The distribution looks a little like a bell curve, but the tail is longer on the left than on the right; that is, there are more light babies than heavy babies.</p>
<p>That makes sense because the distribution includes some babies that were born preterm.</p>
<p><strong>Exercise:</strong> <code class="docutils literal notranslate"><span class="pre">hist</span></code> takes keyword arguments that specify the type and appearance of the histogram.  Find the documentation of <code class="docutils literal notranslate"><span class="pre">hist</span></code> and see if you can figure out how to plot the histogram as an unfilled line.</p>
<p><strong>Exercise:</strong> As we saw in a previous exercise, the NSFG dataset includes a column called <code class="docutils literal notranslate"><span class="pre">agecon</span></code> that records age at conception for each pregnancy.</p>
<ul class="simple">
<li><p>Select this column from the DataFrame, divide by 100 to convert it to years, and assign it to a variable called <code class="docutils literal notranslate"><span class="pre">agecon</span></code>.</p></li>
<li><p>Plot the histogram of these values with 20 bins.</p></li>
<li><p>Label the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> axes appropriately.</p></li>
</ul>
</div>
<div class="section" id="boolean-series">
<h2>Boolean series<a class="headerlink" href="#boolean-series" title="Permalink to this headline">¶</a></h2>
<p>We have seen that the distribution of birth weights is “skewed to the left”; that is, there are more light babies than heavy ones and they are farther from the mean.</p>
<p>That’s because preterm babies tend to be lighter.  The most common duration for pregnancy is 39 weeks, which is “full term”; “preterm” is usually defined to be less than 37 weeks.</p>
<p>To see which babies are preterm, we can use <code class="docutils literal notranslate"><span class="pre">prglngth</span></code>, which records pregnancy length in weeks.</p>
<p>To identify babies that were born preterm, we can compare <code class="docutils literal notranslate"><span class="pre">prglngth</span></code> to 37.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;prglngth&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">)</span>
<span class="n">preterm</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtype(&#39;bool&#39;)
</pre></div>
</div>
</div>
</div>
<p>When you compare a Series to a value, the result is a Boolean Series; that is, each element is a Boolean value, True or False.  In this case, it’s True for each preterm baby and False otherwise.  We can use <code class="docutils literal notranslate"><span class="pre">head</span></code> to see the first 5 elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    False
1     True
2     True
3     True
4    False
Name: prglngth, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>If you compute the sum of a Boolean Series, it treats True as 1 and False as 0, so the sum is the number of Trues, which is the number of preterm babies, about 3700.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3742
</pre></div>
</div>
</div>
</div>
<p>If you compute the mean, you get the <em>fraction</em> of Trues; in this case, it’s close to 0.4; that is, the durations of 40% of the pregnancies are less than 37 weeks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.39987176747168196
</pre></div>
</div>
</div>
</div>
<p>However, this result might be misleading because it includes all pregnancy outcomes, not just live births.</p>
<p>We can create another Boolean Series to indicate which pregnancies ended in live birth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">live</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;outcome&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">live</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6934173968796752
</pre></div>
</div>
</div>
</div>
<p>Now we can use the logical operator <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> to identify pregnancies where the outcome is a preterm live birth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">live_preterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">live</span> <span class="o">&amp;</span> <span class="n">preterm</span><span class="p">)</span>
<span class="n">live_preterm</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.09724300064116265
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise:</strong> Of all live births, what fraction are preterm?</p>
<p>The other common logical operators are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>, which is the OR operator; for example <code class="docutils literal notranslate"><span class="pre">live</span> <span class="pre">|</span> <span class="pre">preterm</span></code> is true if either <code class="docutils literal notranslate"><span class="pre">live</span></code> is true, or <code class="docutils literal notranslate"><span class="pre">preterm</span></code> is true, or both.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~</span></code>, which is the NOT operator; for example <code class="docutils literal notranslate"><span class="pre">~live</span></code> is true if <code class="docutils literal notranslate"><span class="pre">live</span></code> is false or NaN.</p></li>
</ul>
<p>The logical operators treat NaN the same as False.  So you should be careful about using the NOT operator with a Series that contains NaN values.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">~preterm</span></code> would include full term pregnancies, which is probably what you want, and pregnancies with unknown length, which might not be.</p>
<p><strong>Exercise:</strong> What fraction pregnancies are full term, that is, 37 weeks or more?</p>
<p>Of all live births, what fraction are full term?</p>
</div>
<div class="section" id="filtering">
<h2>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h2>
<p>We can use a Boolean Series as a filter; that is, we can select only rows that satisfy a condition or meet some criterion.</p>
<p>For example, we can use <code class="docutils literal notranslate"><span class="pre">preterm</span></code> and the bracket operator to select values from <code class="docutils literal notranslate"><span class="pre">birth_weight</span></code>, so <code class="docutils literal notranslate"><span class="pre">preterm_weight</span></code> gets birth weights for preterm babies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preterm_weight</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="p">[</span><span class="n">preterm</span><span class="p">]</span>
<span class="n">preterm_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.577598314606742
</pre></div>
</div>
</div>
</div>
<p>To select full-term babies, we can create a Boolean Series like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fullterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;prglngth&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">37</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And use it to select birth weights for full term babies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_term_weight</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="p">[</span><span class="n">fullterm</span><span class="p">]</span>
<span class="n">full_term_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.372323879231473
</pre></div>
</div>
</div>
</div>
<p>As expected, full term babies are heavier, on average, than preterm babies.</p>
<p>To be more explicit, we could also limit the results to live births, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_term_weight</span> <span class="o">=</span> <span class="n">birth_weight</span><span class="p">[</span><span class="n">live</span> <span class="o">&amp;</span> <span class="n">fullterm</span><span class="p">]</span>
<span class="n">full_term_weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.372323879231473
</pre></div>
</div>
</div>
</div>
<p>But in this case it doesn’t make a difference because <code class="docutils literal notranslate"><span class="pre">birth_weight</span></code> is only valid for live births.</p>
<p><strong>Exercise:</strong> Let’s see if there is a difference in weight between single births and multiple births (twins, triplets, etc.).</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">nbrnaliv</span></code> represents the number of babies born alive from a pregnancy.  Here’s a cleaned version of this variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrnaliv_clean</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;nbrnaliv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">nbrnaliv_clean</span></code> and <code class="docutils literal notranslate"><span class="pre">live</span></code> to create a Boolean series called <code class="docutils literal notranslate"><span class="pre">multiple</span></code> that is true for multiple live births.</p>
<p>Of all live births, what fraction are multiple births?</p>
<p><strong>Exercise:</strong> Make a Boolean series called <code class="docutils literal notranslate"><span class="pre">single</span></code> that is true for single live births.</p>
<p>Of all single births, what fraction are preterm?</p>
<p>Of all multiple births, what fraction are preterm?</p>
<p><strong>Exercise:</strong> What is the average birth weight for live, single, full-term births?</p>
</div>
<div class="section" id="resampling">
<h2>Resampling<a class="headerlink" href="#resampling" title="Permalink to this headline">¶</a></h2>
<p>We are almost ready to compute the average birth weight, but there’s one more thing we have to do: resampling.</p>
<p>The NSFG is not exactly representative of the U.S. population; by design, some groups are more likely to appear in the sample than others; that is, they are “oversampled”.  Oversampling helps to ensure that you have enough people in every subgroup to get reliable statistics, but it makes the analysis a little more complicated.</p>
<p>However, we can correct for oversampling by “resampling”.  The key is that each pregnancy in the dataset has a “sampling weight” that indicates how many pregnancies it represents.  In the <code class="docutils literal notranslate"><span class="pre">nsfg</span></code> DataFrame, the sampling weight is stored in a column named <code class="docutils literal notranslate"><span class="pre">wgt2013_2015</span></code>.</p>
<p>Here’s what it looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;wgt2013_2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count     9358.000000
mean     10759.200147
std      11400.179222
min       1859.105000
25%       4340.053407
50%       7062.994158
75%      12629.322982
max      75399.410000
Name: wgt2013_2015, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The lowest value in this column is about 1859, which means that a pregnancy with that weight represents 1859 total pregnancies in the population.</p>
<p>The highest weight is about 75399, which means that this observed pregnancy represents substantially more pregnancies in the population.</p>
<p>To take these weights into account, we can resample the DataFrame, which means that we draw a new random sample from the rows in the DataFrame using a weighted sampling process so that rows with higher weights are more likely than rows with lower weights.</p>
<p>DataFrame provides a method called <code class="docutils literal notranslate"><span class="pre">sample</span></code> that does what we want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nsfg</span><span class="p">)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s1">&#39;wgt2013_2015&#39;</span><span class="p">]</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">nsfg</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> 
                     <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                     <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the arguments mean:</p>
<ul class="simple">
<li><p>The size of the sample, <code class="docutils literal notranslate"><span class="pre">n</span></code>, is the same as the size of the DataFrame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replace</span></code> means that sampling is done “with replacement”, so some rows appear in the sample more than once and some might not appear at all.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weights</span></code> are used to weight the sampling process, so each rows appears in the sample with frequency proportional to its weight.</p></li>
</ul>
<p><strong>Exercise:</strong> Now let’s bring it all together.  To test your recall, try to do this exercise without referring back to previous code.</p>
<ol class="simple">
<li><p>From <code class="docutils literal notranslate"><span class="pre">sample</span></code>, extract <code class="docutils literal notranslate"><span class="pre">birthwgt_lb1</span></code> and <code class="docutils literal notranslate"><span class="pre">birthwgt_oz1</span></code> and assign them to <code class="docutils literal notranslate"><span class="pre">pounds</span></code> and <code class="docutils literal notranslate"><span class="pre">ounces</span></code>.</p></li>
<li><p>Clean both variables by replacing <code class="docutils literal notranslate"><span class="pre">98</span></code> and <code class="docutils literal notranslate"><span class="pre">99</span></code> with NaN.</p></li>
<li><p>Compute total birthweight in pounds and display the mean.</p></li>
<li><p>Compute Boolean Series for live, single, and full-term babies.</p></li>
<li><p>Select birthweights for live, single, full-term babies and display their mean weight.</p></li>
</ol>
<p>Most of the time, you will find that the resampled data yields a slightly higher estimate for the average birth weight of single, full-term births in the U.S., compared to the unresampled data.</p>
<p>But resampling is a random process, so the results will be slightly different each time you run it.  Later we will see how we can use this variability to quantify the precision of the estimate.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="06_plotting.html" title="previous page">Plotting</a>
    <a class='right-next' id="next-link" href="08_distributions.html" title="next page">Distributions</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Allen B. Downey<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>